<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .axis {
            font: 20px sans-serif;
            font-weight: 500;
        }
    </style>
</head>

<body><!-- Create a div where the graph will take place -->
    <div class="flex justify-center">
        <div id="heatmap" class="my-16"></div>
    </div>
    <script>        // set the dimensions and margins of the graph
        const margin = { top: 80, right: 25, bottom: 80, left: 90 },
            width = 600 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        const svg = d3.select("#heatmap")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        //Read the data
        d3.csv("korelasi.csv").then(function (data) {
            console.log(data);

            // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
            const myGroups = ["pH", "Temprature", "Taste", "Odor", "Fat", "Turbidity", "Colour"]
            const myVars = ["pH", "Temprature", "Taste", "Odor", "Fat", "Turbidity", "Colour"]

            // Build X scales and axis:
            const x = d3.scaleBand()
                .range([0, width])
                .domain(myGroups)
                .padding(0.05);
            svg.append("g")
                .style("font-size", 15)
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x).tickSize(0))
                .select(".domain").remove()

            // Build Y scales and axis:
            const y = d3.scaleBand()
                .range([height, 0])
                .domain(myVars)
                .padding(0.05);
            svg.append("g")
                .style("font-size", 15)
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            // Build color scale
            const myColor = d3.scaleSequential()
                .range(["#fefce8", "#facc15"])
                .domain([0, 1])

            // create a tooltip
            const tooltip = d3.select("#heatmap")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")

            // Three function that change the tooltip when user hover / move / leave a cell
            const mouseover = function (event, d) {
                tooltip
                    .style("opacity", 1)
                d3.select(this)
                    .style("stroke", "orange")
                    .style("opacity", 1)
            }
            const mousemove = function (event, d) {
                tooltip
                    .html("The exact value of<br>this cell is: " + d.Korelasi)
                    .style("left", (event.x) / 2 + "px")
                    .style("top", (event.y) / 2 + "px")
            }
            const mouseleave = function (event, d) {
                tooltip
                    .style("opacity", 0)
                d3.select(this)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
            }

            // add the squares
            svg.selectAll()
                .data(data, function (d) { return d.Fitur1 + ':' + d.Fitur2; })
                .join("rect")
                .attr("x", function (d) { return x(d.Fitur1) })
                .attr("y", function (d) { return y(d.Fitur2) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .style("fill", function (d) { return myColor(d.Korelasi) })
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
        })

        // Add title to graph
        svg.append("text")
            .attr("x", 0)
            .attr("y", -50)
            .attr("text-anchor", "left")
            .style("font-size", "22px")
            .text("Korelasi Antar Atribut pada dataset milknew");

        // Add subtitle to graph
        svg.append("text")
            .attr("x", 0)
            .attr("y", -20)
            .attr("text-anchor", "left")
            .style("font-size", "14px")
            .style("fill", "grey")
            .style("max-width", 400)
            .text("Visualisasi ini di buat untuk mengetahui korelasi antar atribut");
    </script>

    <div class="flex justify-center pb-10">
        <div id="scatter" class="flex flex-row-reverse items-center">
            <div>
                <div class="p-1 border border-2 border-gray-400 rounded-xl">
                    <button id="highButton" class="flex p-2 hover:bg-green-100 rounded-xl w-full">
                        <div class="h-3 w-3 rounded-full bg-green-400 mr-2"></div>
                        <p class="text-xs">High</p>
                    </button>
                    <button id="mediumButton" class="flex p-2 hover:bg-yellow-100 rounded-xl w-full">
                        <div class="h-3 w-3 rounded-full bg-yellow-400 mr-2"></div>
                        <p class="text-xs">Medium</p>
                    </button>
                    <button id="lowButton" class="flex p-2 hover:bg-red-100 rounded-xl w-full">
                        <div class="h-3 w-3 rounded-full bg-red-400 mr-2"></div>
                        <p class="text-xs">Low</p>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // set the dimensions and margins of the graph
        const marginScatter = { top: 60, right: 30, bottom: 60, left: 60 },
            widthScatter = 750 - marginScatter.left - marginScatter.right,
            heightScatter = 580 - marginScatter.top - marginScatter.bottom;

        // append the svg object to the body of the page
        const svgScatter = d3.select("#scatter")
            .append("svg")
            .attr("width", widthScatter + marginScatter.left + marginScatter.right)
            .attr("height", heightScatter + marginScatter.top + marginScatter.bottom)
            .append("g")
            .attr("transform", `translate(${marginScatter.left}, ${marginScatter.top})`);

        //Read the data
        d3.csv("milknew.csv").then(function (data) {

            // Add X axis
            const x = d3.scaleLinear()
                .domain([0, 10])
                .range([0, widthScatter]);
            svgScatter.append("g")
                .attr("transform", `translate(0, ${heightScatter})`)
                .call(d3.axisBottom(x));

            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, 100])
                .range([heightScatter, 0]);
            svgScatter.append("g")
                .call(d3.axisLeft(y));

            // // Color scale: give me a specie name, I return a color
            // const color = d3.scaleOrdinal()
            //     .domain(["high", "medium", "low"])
            //     .range(["#f87171", "#facc15", "#4ade80"])

            // Highlight the specie that is hovered
            const highlight = function (event, d) {

                selected_specie = d.Grade

                d3.selectAll(".dot")
                    .transition()
                    .duration(200)
                    .style("fill", "lightgrey")
                    .attr("r", 3)

                d3.selectAll("." + selected_specie)
                    .transition()
                    .duration(200)
                    .style("fill", color(selected_specie))
                    .attr("r", 7)
            }

            // Highlight the specie that is hovered
            const doNotHighlight = function (event, d) {
                d3.selectAll(".dot")
                    .transition()
                    .duration(200)
                    .style("fill", d => color(d.Grade))
                    .attr("r", 4)
            }

            const color = d3.scaleOrdinal()
                .domain(["low", "medium", "high"])
                .range(["#f87171", "#facc15", "#4ade80"])
            var pilih = 0;
            var selectGrade = "";
            var gradeName = { high: 'high', medium: 'medium', low: 'low' };
            function highlightState(grade) {
                if (pilih == 0 || selectGrade != grade) {
                    pilih = 1;
                    selected_specie = grade;

                    d3.selectAll(".dot")
                        .transition()
                        .duration(200)
                        .style("fill", "lightgrey")
                        .attr("r", 3)

                    d3.selectAll("." + selected_specie)
                        .transition()
                        .duration(200)
                        .style("fill", color(selected_specie))
                        .attr("r", 7)

                    selectGrade = grade;
                } else {
                    pilih = 0;
                    d3.selectAll(".dot")
                        .transition()
                        .duration(200)
                        .style("fill", d => color(d.Grade))
                        .attr("r", 4)

                    selectGrade = grade;
                }
            }

            // Add dots
            svgScatter.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", function (d) { return "dot " + d.Grade })
                .attr("cx", function (d) { return x(d.pH); })
                .attr("cy", function (d) { return y(d.Temprature); })
                .attr("r", 4)
                .style("fill", function (d) { return color(d.Grade) })
                .on("mouseover", highlight)
                .on("mouseleave", doNotHighlight)

            const highButton = document.getElementById("highButton");
            highButton.addEventListener("click", function () {
                highlightState(gradeName.high);
            });

            const mediumButton = document.getElementById("mediumButton");
            mediumButton.addEventListener("click", function () {
                highlightState(gradeName.medium);
            });
            const lowButton = document.getElementById("lowButton");
            lowButton.addEventListener("click", function () {
                highlightState(gradeName.low);
            });

            // Add title to graph
            svgScatter.append("text")
                .attr("x", 0)
                .attr("y", -40)
                .attr("text-anchor", "left")
                .style("font-size", "22px")
                .text("Persebaran grade berdasarkan pH dan Temperature dari susu");

            // Add subtitle to graph
            svgScatter.append("text")
                .attr("x", 0)
                .attr("y", -20)
                .attr("text-anchor", "left")
                .style("font-size", "14px")
                .style("fill", "grey")
                .style("max-width", 400)
                .text("Visualisasi ini di buat untuk mengetahui persebaran kualitas susu berdasarkan pH dan Temperature");

            svgScatter.append("text")      // text label for the x axis
                .attr("x", (widthScatter) / 2)
                .attr("y", heightScatter + 40)
                .style("text-anchor", "middle")
                .text("pH");

            svgScatter.append("text")      // text label for the x axis
                .attr("x", -220)
                .attr("y", -40)
                .attr("transform", "rotate(-90)")
                .style("text-anchor", "middle")
                .text("Temperature");
        });
    </script>

    <div class="flex justify-center my-20">
        <div id="barplot"></div>
        <div id="scatter" class="flex flex-row-reverse items-center">
            <div class="w-48">
                <div class="p-1 pb-2 border border-2 border-b-0 border-gray-400 rounded-xl rounded-b-none font-medium">
                    <div class="flex w-full justify-center py-1">
                        <p id="Title" class="text-normal font-bold"></p>
                    </div>
                    <div class="flex">
                        <div class="h-3 w-3 rounded-full bg-red-400 mr-2"></div>
                        <p id="falseText" class="text-xs"></p>
                    </div>
                    <div class="flex">
                        <div class="h-3 w-3 rounded-full bg-blue-400 mr-2"></div>
                        <p id="trueText" class="text-xs"></p>
                    </div>
                </div>
                <select id="tipe" onchange="updateData()"
                    class="bg-white border border-2 border-gray-400 text-gray-600 text-sm rounded-xl rounded-t-none block w-full p-2.5 font-bold">
                    <option value="Taste" selected>Taste</option>
                    <option value="Odor">Odor</option>
                    <option value="Fat">Fat</option>
                    <option value="Turbidity">Turbidity</option>
                </select>
            </div>
        </div>
    </div>
    <script>
        // set the dimensions and margins of the graph
        const marginBar = { top: 80, right: 30, bottom: 60, left: 60 },
            widthBar = 810 - marginBar.left - marginBar.right,
            heightBar = 750 - marginBar.top - marginBar.bottom;

        // append the svg object to the body of the page
        const svgBar = d3.select("#barplot")
            .append("svg")
            .attr("width", widthBar + marginBar.left + marginBar.right)
            .attr("height", heightBar + marginBar.top + marginBar.bottom)
            .append("g")
            .attr("transform", `translate(${marginBar.left},${marginBar.top})`);

        // List of subgroups = header of the csv files = soil condition here
        const subgroups = ["False", "True"]

        // List of groups = species here = value of the first column called group -> I show them on the X axis
        const groups = ["high", "medium", "low"]

        // Add X axis
        const x = d3.scaleBand()
            .domain(groups)
            .range([0, widthBar])
            .padding([0.2])

        svgBar.append("g")
            .attr("transform", `translate(0, ${heightBar})`)
            .attr("class", "axis")
            .call(d3.axisBottom(x).tickSize(0));

        // Add Y axis
        const y = d3.scaleLinear()
            .domain([0, 400])
            .range([heightBar, 0]);

        svgBar.append("g")
            .call(d3.axisLeft(y));

        // Another scale for subgroup position?
        const xSubgroup = d3.scaleBand()
            .domain(subgroups)
            .range([0, x.bandwidth()])
            .padding([0.05])

        // color palette = one color per subgroup
        const colorBar = d3.scaleOrdinal()
            .domain(subgroups)
            .range(['#f87171', '#60a5fa'])

        function updateData() {
            var dataset = document.getElementById("tipe").value;
            var result = dataset.concat(".csv");

            var dataKeterangan = {
                Fat: { Title: "Kadar Lemak", False: "Sedikit Lemak", True: "Banyak lemak" },
                Taste: {Title: "Rasa", False: "Buruk", True: "Baik" },
                Odor: {Title: "Bau", False: "Berbau", True: "Tidak Berbau" },
                Turbidity: {Title: "Tingkat Kekeruhan", False: "Rendah", True: "Tinggi" }
            };

            document.getElementById("Title").innerHTML = dataKeterangan[dataset].Title;
            document.getElementById("falseText").innerHTML = dataKeterangan[dataset].False;
            document.getElementById("trueText").innerHTML = dataKeterangan[dataset].True;

            console.log(dataKeterangan);

            // Parse the Data
            d3.csv(result).then(function (data) {
                d3.selectAll("#barplotRect").remove()
                // Show the bars
                svgBar.append("g")
                    .selectAll("g")
                    .data(data)
                    .join("g")
                    .attr("transform", d => `translate(${x(d.Grade)}, 0)`)
                    .selectAll("rect")
                    .data(function (d) {
                        return subgroups.map(function (key) {
                            return { key: key, value: d[key] };
                        });
                    })
                    .join("rect")
                    .attr("id", "barplotRect")
                    .attr("x", d => xSubgroup(d.key))
                    .attr("y", d => y(d.value))
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", d => heightBar - y(d.value))
                    .attr("fill", d => colorBar(d.key));
            })
        }

        updateData();

        // text label for the y axis
        svgBar.append("text")
            .attr("x", -300)
            .attr("y", -40)
            .attr("transform", "rotate(-90)")
            .style("text-anchor", "middle")
            .text("Jumlah");

        // Add title to graph
        svgBar.append("text")
            .attr("x", 0)
            .attr("y", -40)
            .attr("text-anchor", "left")
            .style("font-size", "22px")
            .text("Grafik perbandingan dari Taste,Odor,Fat dan Turbidity");

        // Add subtitle to graph
        svgBar.append("text")
            .attr("x", 0)
            .attr("y", -20)
            .attr("text-anchor", "left")
            .style("font-size", "14px")
            .style("fill", "grey")
            .style("max-width", 400)
            .text("Visualisasi ini di buat untuk mengetahui perbedaan dari setiap grade susu");
    </script>
</body> -->